name: "Merge to main (Production)"

on: [pull_request]
#  - push:
#    branches:
#      - main
#    paths:
#      - ".github/workflows/merge_to_main_production.yaml"
#      - "env/production/**"
#      - "PRODUCTION_VERSION"

defaults:
  run:
    shell: bash

jobs:
  kubectl-apply:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Inject token authentication
        run: |
          git config --global url."https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/".insteadOf "https://github.com/"

      - name: Add fake .env
        run: |
          cp env.example env/production/.env

      - name: Apply changes
        run: |
          kubectl kustomize env/production