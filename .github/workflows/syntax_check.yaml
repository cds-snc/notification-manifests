name: Testing manifest

on: 
  - pull_request

env:
  KUBECTL_VERSION: 1.23.6

jobs:
  testing_manifest:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@7884fcad6b5d53d10323aee724dc68d8b9096a2e # tag=v2

      - name: Install kubectl
        run: |
          curl -LO https://dl.k8s.io/release/v$KUBECTL_VERSION/bin/linux/amd64/kubectl
          chmod +x kubectl
          mv kubectl /usr/local/bin/
          kubectl version --client

      - name: Add fake .env
        run: |
          cp env.example env/staging/.env
          cp env.example env/production/.env

      - name: Test staging manifest build
        uses: ./.github/actions/test-manifest
        if: always()
        with:
          build-target: staging-debug
          echo-manifest: true

      - name: Test production manifest build
        uses: ./.github/actions/test-manifest
        if: always()
        with:
          build-target: production-debug          
  