{{- if .Values.secretProviderClass.enabled }}
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: {{ include "notify.fullname" . }}
  labels:
    {{- include "notify.labels" . | nindent 4 }}
spec:
  provider: {{ .Values.secretProviderClass.provider }}
  #This is the source names from AWS Secrets Manager
  parameters:
    objects: |
      - objectName: BASE_DOMAIN
        objectType: "secretsmanager" 
      - objectName: ADMIN_CLIENT_SECRET
        objectType: "secretsmanager"
      - objectName: AWS_ROUTE53_ZONE
        objectType: "secretsmanager"
      - objectName: AWS_SES_REGION
        objectType: "secretsmanager"
      - objectName: AWS_SES_SMTP
        objectType: "secretsmanager"
      - objectName: AWS_SES_ACCESS_KEY
        objectType: "secretsmanager"
      - objectName: AWS_SES_SECRET_KEY
        objectType: "secretsmanager"
      - objectName: CRM_GITHUB_PERSONAL_ACCESS_TOKEN
        objectType: "secretsmanager"
{{ if not (eq .Values.env "production") }}        
      - objectName: DEBUG_KEY
        objectType: "secretsmanager"
{{ end }}
      - objectName: DANGEROUS_SALT
        objectType: "secretsmanager"
      - objectName: REDIS_URL
        objectType: "secretsmanager"
      - objectName: SALESFORCE_ENGAGEMENT_PRODUCT_ID
        objectType: "secretsmanager"
      - objectName: SALESFORCE_ENGAGEMENT_RECORD_TYPE
        objectType: "secretsmanager"
      - objectName: SALESFORCE_ENGAGEMENT_STANDARD_PRICEBOOK_ID
        objectType: "secretsmanager"
      - objectName: SALESFORCE_GENERIC_ACCOUNT_ID
        objectType: "secretsmanager"
      - objectName: SALESFORCE_PASSWORD
        objectType: "secretsmanager"
      - objectName: SALESFORCE_SECURITY_TOKEN
        objectType: "secretsmanager"
      - objectName: SALESFORCE_USERNAME
        objectType: "secretsmanager"
      - objectName: SECRET_KEY
        objectType: "secretsmanager"
      - objectName: SENDGRID_API_KEY
        objectType: "secretsmanager"
      - objectName: SQLALCHEMY_DATABASE_URI
        objectType: "secretsmanager"
      - objectName: AWS_US_TOLL_FREE_NUMBER
        objectType: "secretsmanager"
      - objectName: ZENDESK_SELL_API_URL
        objectType: "secretsmanager"
      - objectName: ZENDESK_SELL_API_KEY
        objectType: "secretsmanager"
      - objectName: ZENDESK_API_URL
        objectType: "secretsmanager"
      - objectName: ZENDESK_API_KEY
        objectType: "secretsmanager"
      - objectName: ALLOW_HTML_SERVICE_IDS
        objectType: "secretsmanager"
      - objectName: AWS_PINPOINT_REGION
        objectType: "secretsmanager"
      - objectName: AWS_REGION
        objectType: "secretsmanager"
      - objectName: FRESH_DESK_API_URL
        objectType: "secretsmanager"
      - objectName: FRESH_DESK_API_KEY
        objectType: "secretsmanager"
      - objectName: FRESH_DESK_PRODUCT_ID
        objectType: "secretsmanager"
      - objectName: SQLALCHEMY_DATABASE_READER_URI
        objectType: "secretsmanager"
      - objectName: POSTGRES_HOST
        objectType: "secretsmanager"
      - objectName: SRE_CLIENT_SECRET
        objectType: "secretsmanager"
      - objectName: SENTRY_URL
        objectType: "secretsmanager"
      - objectName: NEW_RELIC_LICENSE_KEY
        objectType: "secretsmanager"

  #This is the target name in the kubernetes secret      
  secretObjects:
    - data:
      - key: ADMIN_BASE_URL
        objectName: BASE_DOMAIN 
      - key: ADMIN_CLIENT_SECRET
        objectName: ADMIN_CLIENT_SECRET
      - key: AWS_ROUTE53_ZONE
        objectName: AWS_ROUTE53_ZONE
      - key: AWS_SES_REGION
        objectName: AWS_SES_REGION
      - key: AWS_SES_SMTP
        objectName: AWS_SES_SMTP
      - key: AWS_SES_ACCESS_KEY
        objectName: AWS_SES_ACCESS_KEY
      - key: AWS_SES_SECRET_KEY
        objectName: AWS_SES_SECRET_KEY
      - key: CRM_GITHUB_PERSONAL_ACCESS_TOKEN
        objectName: CRM_GITHUB_PERSONAL_ACCESS_TOKEN
        {{ if not (eq .Values.env "production") }}   
      - key: DEBUG_KEY
        objectName: DEBUG_KEY
        {{ end }}
      - key: DANGEROUS_SALT
        objectName: DANGEROUS_SALT
      - key: REDIS_URL
        objectName: REDIS_URL
      - key: SALESFORCE_ENGAGEMENT_PRODUCT_ID
        objectName: SALESFORCE_ENGAGEMENT_PRODUCT_ID
      - key: SALESFORCE_ENGAGEMENT_RECORD_TYPE
        objectName: SALESFORCE_ENGAGEMENT_RECORD_TYPE
      - key: SALESFORCE_ENGAGEMENT_STANDARD_PRICEBOOK_ID
        objectName: SALESFORCE_ENGAGEMENT_STANDARD_PRICEBOOK_ID
      - key: SALESFORCE_GENERIC_ACCOUNT_ID
        objectName: SALESFORCE_GENERIC_ACCOUNT_ID
      - key: SALESFORCE_PASSWORD
        objectName: SALESFORCE_PASSWORD
      - key: SALESFORCE_SECURITY_TOKEN
        objectName: SALESFORCE_SECURITY_TOKEN
      - key: SALESFORCE_USERNAME
        objectName: SALESFORCE_USERNAME
      - key: SECRET_KEY
        objectName: SECRET_KEY
      - key: SENDGRID_API_KEY
        objectName: SENDGRID_API_KEY
      - key: SQLALCHEMY_DATABASE_URI
        objectName: SQLALCHEMY_DATABASE_URI
      - key: POSTGRES_HOST
        objectName: POSTGRES_HOST
      - key: AWS_US_TOLL_FREE_NUMBER
        objectName: AWS_US_TOLL_FREE_NUMBER
      - key: ZENDESK_SELL_API_URL
        objectName: ZENDESK_SELL_API_URL
      - key: ZENDESK_SELL_API_KEY
        objectName: ZENDESK_SELL_API_KEY
      - key: ZENDESK_API_URL
        objectName: ZENDESK_API_URL
      - key: ZENDESK_API_KEY
        objectName: ZENDESK_API_KEY
      - key: ALLOW_HTML_SERVICE_IDS
        objectName: ALLOW_HTML_SERVICE_IDS
      - key: AWS_PINPOINT_REGION
        objectName: AWS_PINPOINT_REGION
      - key: AWS_REGION
        objectName: AWS_REGION
      - key: FRESH_DESK_API_URL
        objectName: FRESH_DESK_API_URL
      - key: FRESH_DESK_API_KEY
        objectName: FRESH_DESK_API_KEY
      - key: FRESH_DESK_PRODUCT_ID
        objectName: FRESH_DESK_PRODUCT_ID
      - key: SQLALCHEMY_DATABASE_READER_URI
        objectName: SQLALCHEMY_DATABASE_READER_URI
      - key: SRE_CLIENT_SECRET
        objectName: SRE_CLIENT_SECRET
      - key: SENTRY_URL
        objectName: SENTRY_URL
      - key: NEW_RELIC_LICENSE_KEY
        objectName: NEW_RELIC_LICENSE_KEY

      secretName: notify-api
      type: generic

{{ end }}
